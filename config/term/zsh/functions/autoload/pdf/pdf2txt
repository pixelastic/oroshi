# Extract all text content from a PDF into a txt file
# Usage
# $ pdf2txt ./path/to/file.pdf              # Creates a .txt file (default: no layout)
# $ pdf2txt --keepLayout ./path/to/file.pdf # Creates a .txt file with layout preserved
# $ pdf2txt ./path/to/file.pdf 12           # Creates a dump of only page 12
function pdf2txt() {
  # Parse arguments
  zparseopts -E -D \
    -keepLayout=flagKeepLayout
  local isKeepLayout=${#flagKeepLayout}

  for inputFilepath in "$@"; do
    local inputFilepath=${inputFilepath:a}
    local dirpath=${inputFilepath:h}
    local filepathBasename=${inputFilepath:t:r}
    local outputFilepath="${dirpath}/${filepathBasename}.txt"

    # Known errors that we can ignore
    local knownErrorsPattern='Syntax Warning: Invalid Font Weight'

    # Build additional flags based on options
    local additionalFlags=()
    [[ $isKeepLayout == "1" ]] && additionalFlags+=('-layout')

    pdftotext \
      $additionalFlags \
      "$inputFilepath" \
      - \
      2> >(\grep -v "${knownErrorsPattern}" >&2) \
      >"$outputFilepath"
  done
}
