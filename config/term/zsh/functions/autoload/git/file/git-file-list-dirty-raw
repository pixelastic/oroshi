# List all dirty files (modified, added, or deleted since last commit)
# Output format: STATUS:FILEPATH
# STATUS can be: M (Modified), A (Added), D (Deleted)
function git-file-list-dirty-raw() {
  local gitRoot="$(git-directory-root)"
  local dirtyFiles="$(git -C "${gitRoot}" status --porcelain --short)"

  for line in ${(f)dirtyFiles}; do
    local stagedStatus="${line[1]}"
    local stageableStatus="${line[2]}"
    local filePath="${line:3}"

    # ?? means that the file is not staged
    [[ "$stagedStatus" == "?" ]] && stagedStatus=" "
    [[ "$stageableStatus" == "?" ]] && stageableStatus="A"

    # Prefer stageable status (more recent)
    local gitStatus="$stageableStatus"
    [[ "$gitStatus" == " " ]] && gitStatus="$stagedStatus"

    echo "${gitStatus}:${filePath}"
  done
}
