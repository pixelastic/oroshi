#compdef

# List of all scripts entry in package.json
function _package-scripts() {
  # Stop if no package.json
  local packageJsonPath="$(find-up package.json)"
  [[ $packageJsonPath == "" ]] && return 0

  # Create a list of all key:value of the .scripts key
  local suggestions="$(\
    cat $packageJsonPath \
    | jq \
      --raw-output \
      '.scripts | to_entries[] | [(.key | gsub(":";"\\:")), .value] | join(":")'
  )"
  suggestions=(${(f)suggestions})

  # Suggest the available scripts
  _describe -V "$(completion-header $COLOR_ALIAS_LANGUAGE_JAVASCRIPT $COLOR_BLACK ' îœ˜ package.json scripts ')" suggestions
}
