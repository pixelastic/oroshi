# Save the current PWD context of fzf, so we can access it from the source
# script
#
# fzf-pwd-save /home/tim   # Save "/home/tim" as the current pwd
function fzf-pwd-save() {
	local key="pwd"
	local value=$1

	# Special value "__FZF_DIRECTORIES_UP__" means we need to move one directory up
	# from the previously saved directory
	if [[ $value == "__FZF_DIRECTORIES_UP__" ]]; then
		local previousValue="$(fzf-var-read $key)"
		[[ $previousValue == "" ]] && previousValue="$(pwd)"
		value=${previousValue:h}
	fi

	# If selecting a file, we use the parent directory
	if [[ -f $value ]]; then
		value=${value:h}
	fi

	value=${value:a}
	# Save on disk
	fzf-var-write $key $value
	echo $value
}
