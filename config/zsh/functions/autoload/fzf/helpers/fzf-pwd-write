# Save the "current pwd" of fzf.
# This is used to keep some state when using the [left] and [right] keys to
# navigate folders
#
# fzf-pwd-write /home/tim   # Save "/home/tim" as the current pwd
# fzf-pwd-write __FZF_DIRECTORIES_UP__  # Special value to save the parent folder
function fzf-pwd-write() {
	local key="pwd"
	local value=$1

	# Special value "__FZF_DIRECTORIES_UP__" means we need to move one directory up
	# from the previously saved directory
	if [[ $value == "__FZF_DIRECTORIES_UP__" ]]; then
		local previousValue="$(fzf-var-read $key)"
		[[ $previousValue == "" ]] && previousValue="$(pwd)"
		value=${previousValue:h}
	fi

	# If selecting a file, we use the parent directory
	if [[ -f $value ]]; then
		value=${value:h}
	fi

	value=${value:a}
	# Save on disk
	fzf-var-write $key $value
	echo $value
}
