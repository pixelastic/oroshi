#!/usr/bin/env zsh
# Check if the current repository has real yarn links (excluding those from the
# same repo)
[[ ! $commands[yarn] ]] && exit 1

local root="$(git root)"
local node_modules="${root}/node_modules"

# Find all symlinks in node_module (and in scoped subfolders), resolve their
# target, match all those that start with the git root, then invert the
# selection. If there is something, we have a yarn link
find \
  $node_modules \
  $node_modules/@* \
  -maxdepth 1 \
  -type l \
  -exec readlink -f {} + \
  2>/dev/null \
  | grep \
    --quiet \
    --invert-match \
    "^$root"

