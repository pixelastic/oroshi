#!/usr/bin/env zsh
# Fuzzy finding in git commits

# Build the display line
local formatString=""
formatString+="%C(${COLOR_ALIAS_GIT_COMMIT}) %h%Creset  "
formatString+="%C(${COLOR_ALIAS_DATE}) %cd%Creset  "
formatString+="%C(${COLOR_ALIAS_GIT_MESSAGE})%s%Creset"

# Find all commits
local selection="$(\
git \
  log \
  --date=format:'%Y-%m-%d' \
  --format="$formatString" \
  --color=always \
  | fzf \
    --ansi \
    --preview-window 'right,50%,border-left,<79(bottom,50%,border-top)' \
    --preview "fzf-git-commits-preview {}" \
)"

# Stop if no selection
[[ "$selection" == "" ]] && exit 1

# Find the commit
local commitHash="$(cut -d ' ' -f2 <<< "$selection")"

echo $commitHash
