#!/usr/bin/env zsh
set -e
# Commit all changes
# Usage:
# $ git-commit-all                      # Commit all changes, and ask for message
# $ git-commit-all "Commit message"     # Commit all changes with message
# $ git-commit-all -n "Commit message"  # Can pass arguments to git commit

local args=($@)

# Find the commit message
local commitMessage=""
local commitMessageIndex=""
for ((argIndex=1; argIndex <= ${#args}; argIndex++)); do
  local argValue=$args[$argIndex]
  [[ $argValue = -* ]] && continue
  commitMessage=$argValue
  args[$argIndex]=()
done

# If a commit message is passed, we add it to the args
if [[ $commitMessage != "" ]]; then
  args+=("--message")
  args+=($commitMessage)
fi

# We always make it verbose
args+=("--verbose")

# Commit all files
git add --all
git commit ${args}
