#!/usr/bin/env zsh
# Check if a specific file changed, relative to commits
# Usage:
# $ git-file-has-changed package.json 
#   => Check between working directory and last commit
# $ git-file-has-changed package.json abcdef
#   => Check between working directory and specific commit
# $ git-file-has-changed package.json abcdef d34db33f
#   => Check between two specific commits

local filepath=$1
local commitStart=$2
local commitEnd=$3

local changed=''

# Changes in working directory
if [[ $commitStart == '' && $commitEnd == '' ]]; then
  changed="$(git diff --name-only $filepath)"
fi

# Changes since specific commit
if [[ $commitStart != '' && $commitEnd == '' ]]; then
 changed="$(git diff --name-only ${commitStart}.. -- $filepath)"
fi

# Changes between two commits
if [[ $commitStart != '' && $commitEnd != '' ]]; then
  diff="$(git diff --name-only ${commitStart}..${commitEnd} -- $filepath)"
fi

# The file hasn't been changed, so we fail the script
if [[ $changed == '' ]]; then
  exit 1
fi
exit 0
