#!/usr/bin/env ruby
require_relative '../etc/docker-helper/docker_helper'

# Delete containers
class DockerContainerRemove
  include DockerHelper

  def initialize(*args)
    @containers = args.to_a
    if @containers.include?('--all')
      @containers = `docker-container-list-bare`.lines
    end

    return unless @containers.empty?

    puts 'Usage:'
    puts '$ docker-container-remove container_name [container_name] [--all]'
    exit 1
  end

  def run
    @containers.each do |container|
      unless container?(container)
        puts "âœ˜ Container #{colorize(container, :container)} does not exist"
        next
      end
      options = [
        'docker',
        'rm',
        '--force',
        container
      ].compact

      IO.popen(options.join(' ')).each do |line|
        puts line.chomp
      end
    end
  end
end
DockerContainerRemove.new(*ARGV).run
