#!/usr/bin/env zsh
# Using rg to display results in a format suitable for fzf
# Used by `g` and `fzf-search-in-files`
# Usage:
# $ fzf-g query           # Display all matches for "query"
# $ fzf-g --flag query    # Also pass --flag to rg

# Filter positional arguments and flags
local argsp=()
local -A argsf; argsf=()
for arg in $argv; do
  [[ "$arg" =~ "^-" ]] && argsf[$arg]=1 || argsp+="$arg"
done

# Find all matches in files
# Display one line per match, with the filepath at the beginning
rg \
  --glob='!.git' \
  --context 0 \
  --line-number \
  --no-heading \
  ${(k)argsf} \
  -- "$argsp"
