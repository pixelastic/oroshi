#!/usr/bin/env zsh
# Fuzzy finding in git commits, returning the hash

# Build the display line
local formatString=""
formatString+="%C(${COLOR_ALIAS_GIT_COMMIT}) %h%Creset  "
formatString+="%C(${COLOR_ALIAS_DATE}) %cd%Creset  "
formatString+="%C(${COLOR_ALIAS_GIT_MESSAGE})%s%Creset"

# Find all commits
local selection="$(\
git \
  log \
  --date=format:'%Y-%m-%d' \
  --format="$formatString" \
  --color=always \
  | fzf \
    --preview "fzf-git-commit-history-preview {}" \
)"

# Stop if no selection
[[ "$selection" == "" ]] && exit 1

# Find the commit
selection="$(cut -d ' ' -f2 <<< "$selection")"

# Convert multi selections into single line
selection=("${(f)selection}")

echo $selection
