#!/usr/bin/env zsh
# Search in files for a specific query, and allow selecting one
# Usage:
# $ g query       # Display all files matching a specific query

# Show them in fzf
local selection="$(fzf-g $@ | \
  fzf \
  --no-sort \
  --ansi \
  --no-keep-right \
  --delimiter ':' \
  --nth 1,3 \
  --preview 'fzf-preview {1} --highlight-line {2}'
)"

# Stop if no selection
[[ $selection == "" ]] && exit 1

# Open selected file
local filepath="$(cut -d ':' -f 1 <<< $selection)"
local lineNumber="$(cut -d ':' -f 2 <<< $selection)"
nvim "${filepath}" +$lineNumber
