#!/usr/bin/env zsh
# Commits a running oroshi container into an image
# Usage:
# $ docker-oroshi-commit               # Updates oroshi:latest image
# $ docker-oroshi-commit patch         # Creates a new patch tag
#
# TODO: Need a commit message (on the CLI, or through editor)
# TODO: Need to pass a --minor or --major flag

local containerName="$(docker-oroshi-container)"

# Stops if oroshi is not running
if ! docker-container-is-running $containerName; then
  echo "Oroshi is not running"
  exit 1
fi

# Increment the version
local oroshiTagCurrent="$(docker-oroshi-tag)"
local oroshiTagNext="$(version-increment $oroshiTagCurrent)"

docker commit \
  --pause \
  $containerName \
  "oroshi:${oroshiTagNext}" \
  >/dev/null

echo "oroshi:${oroshiTagNext} commited"
